<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词消消乐</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            padding: 1px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 1px;
        }
        .title-text {
            color: #6a11cb;
            margin-bottom: 1px;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            background: linear-gradient(to right, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 1px 0;
        }
        .game-info {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-bottom: 5px;
        }
        .timer, .score {
            font-size: 1rem;
            font-weight: bold;
            color: #333;
            background: rgba(255,255,255,0.8);
            padding: 6px 10px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        .timer::before {
            content: "⏱️";
            margin-right: 6px;
        }
        .score::before {
            content: "🏆";
            margin-right: 6px;
        }
        .buttons {
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        button {
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #startBtn {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
        }
        #startBtn:hover {
            background: linear-gradient(to right, #2575fc, #6a11cb);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        #importBtn {
            background: linear-gradient(to right, #11998e, #38ef7d);
            color: white;
        }
        #importBtn:hover {
            background: linear-gradient(to right, #38ef7d, #11998e);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        button:disabled {
            background: #cccccc !important;
            cursor: not-allowed;
            transform: none !important;
        }
        button::before {
            margin-right: 8px;
        }
        #startBtn::before {
            content: "🚀";
        }
        #importBtn::before {
            content: "📂";
        }
        .small-display {
            width: 150px;
            height: 50px;
            margin: 0 auto 10px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
            padding: 15px;
            text-align: center;
            border: 3px solid white;
        }
        .large-display {
            width: 1200px;
            height: 500px;
            margin: 0 auto;
            background: linear-gradient(to bottom, #e0eafc, #cfdef3);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            border: 3px solid white;
        }
        .word {
            position: absolute;
            padding: 12px 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            user-select: none;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.5);
        }
        .word:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .word.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.1);
        }
        .word.shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1.05); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) scale(1.05); }
            20%, 40%, 60%, 80% { transform: translateX(5px) scale(1.05); }
        }
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(106,17,203,0.9) 0%, rgba(37,117,252,0.9) 100%);
            color: white;
            padding: 30px 60px;
            border-radius: 20px;
            font-size: 1.8rem;
            display: none;
            z-index: 100;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            text-align: center;
            backdrop-filter: blur(5px);
            border: 3px solid rgba(255,255,255,0.3);
        }
        .message::after {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%, rgba(255,255,255,0.2) 100%);
            z-index: -1;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            pointer-events: none;
        }
      



/* 计时器选择下拉菜单样式 */
        .time-select {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(to right, #6a5acd, #9370db);
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            outline: none;
        }
        .time-select option {
            background: #9370db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏅️<span class="title-text">单词消消乐</span>🏅️</h1>
       
        <div class="game-info">
 <div class="timer">
            <label for="gameTime">游戏时间:</label>
            <select id="gameTime" class="time-select">
                <option value="60">1分钟</option>
                <option value="120" selected>2分钟</option>
                <option value="180">3分钟</option>
            </select>
        </div>
            <div class="score">得分: 0</div>
        </div>
        <div class="buttons">
            <button id="startBtn">开始游戏</button>
            <button id="importBtn">导入文本</button>
        </div>
        <div class="small-display" id="meaningDisplay">等待开始...</div>
        <div class="large-display" id="wordDisplay"></div>
        <div class="message" id="message"></div>
    </div>

    <script>
        // 游戏变量
        let timer;
        let timeLeft = 120;
        let score = 0;
        let isGameRunning = false;
        let wordsData = [];
        let currentMeaning = '';
        let currentMeaningIndex = -1;
        let wordElements = [];
        let usedMeanings = [];
        
        // DOM元素
        const startBtn = document.getElementById('startBtn');
        const importBtn = document.getElementById('importBtn');
        const meaningDisplay = document.getElementById('meaningDisplay');
        const wordDisplay = document.getElementById('wordDisplay');
        const timerDisplay = document.querySelector('.timer');
        const scoreDisplay = document.querySelector('.score');
        const messageDisplay = document.getElementById('message');
        const gameTimeSelect = document.getElementById('gameTime');
        
        // 导入文本
        importBtn.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.txt';
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const content = event.target.result;
                    parseWordsData(content);
                };
                reader.readAsText(file);
            });
            
            fileInput.click();
        });
        
        // 解析单词数据
        function parseWordsData(content) {
            wordsData = [];
            const lines = content.split('\n');
            
            for (const line of lines) {
                if (line.trim() === '') continue;
                
                const parts = line.split(',');
                if (parts.length >= 2) {
                    const word = parts[0].trim();
                    const meaning = parts[1].trim();
                    wordsData.push({ word, meaning });
                }
            }
            
            showMessage(`成功导入 ${wordsData.length} 个单词`, '#38ef7d');
        }
        
        // 开始游戏
        startBtn.addEventListener('click', () => {
            if (wordsData.length === 0) {
                showMessage('请先导入单词文本！', '#f5576c');
                return;
            }
            
            if (isGameRunning) {
                resetGame();
                return;
            }
            
            startGame();
        });
        
        // 初始化游戏
        function startGame() {
            isGameRunning = true;
            // 从下拉菜单获取选择的游戏时间
            timeLeft = parseInt(gameTimeSelect.value);
            score = 0;
            usedMeanings = [];
            wordElements = [];
            
            updateTimerDisplay();
            updateScoreDisplay();
            startBtn.textContent = '重新开始';
            importBtn.disabled = true;
            gameTimeSelect.disabled = true;
            
            // 清空显示区域
            wordDisplay.innerHTML = '';
            meaningDisplay.textContent = '';
            meaningDisplay.style.background = 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)';
            
            // 创建单词元素
            createWordElements();
            
            // 显示第一个单词意思
            showNextMeaning();
            
            // 开始计时
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        // 创建单词元素
        function createWordElements() {
            const displayWidth = wordDisplay.clientWidth;
            const displayHeight = wordDisplay.clientHeight;
            
            // 确保单词不重叠
            const positions = [];
            
            wordsData.forEach((item, index) => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word';
                wordElement.textContent = item.word;
                wordElement.dataset.word = item.word;
                wordElement.dataset.meaning = item.meaning;
                
                // 随机位置（确保不重叠）
                let x, y, overlap;
                const wordWidth = 100; // 预估宽度
                const wordHeight = 40;  // 预估高度
                
                do {
                    overlap = false;
                    x = Math.random() * (displayWidth - wordWidth);
                    y = Math.random() * (displayHeight - wordHeight);
                    
                    // 检查是否与已有位置重叠
                    for (const pos of positions) {
                        if (Math.abs(x - pos.x) < wordWidth + 20 && Math.abs(y - pos.y) < wordHeight + 20) {
                            overlap = true;
                            break;
                        }
                    }
                } while (overlap);
                
                positions.push({ x, y, width: wordWidth, height: wordHeight });
                
                wordElement.style.left = `${x}px`;
                wordElement.style.top = `${y}px`;
                
                // 点击事件
                wordElement.addEventListener('click', handleWordClick);
                
                wordDisplay.appendChild(wordElement);
                wordElements.push(wordElement);
                
                // 设置随机移动
                setRandomMovement(wordElement, displayWidth, displayHeight);
            });
        }
        
        // 设置单词随机移动
        function setRandomMovement(element, maxWidth, maxHeight) {
            const speed = 0.5 + Math.random() * 1.5;
            let x = parseFloat(element.style.left);
            let y = parseFloat(element.style.top);
            let dx = (Math.random() - 0.5) * speed;
            let dy = (Math.random() - 0.5) * speed;
            
            const move = () => {
                if (!isGameRunning) return;
                
                const width = element.offsetWidth;
                const height = element.offsetHeight;
                
                x += dx;
                y += dy;
                
                // 边界检测
                if (x <= 0 || x + width >= maxWidth) {
                    dx = -dx;
                    x = x <= 0 ? 0 : maxWidth - width;
                }
                
                if (y <= 0 || y + height >= maxHeight) {
                    dy = -dy;
                    y = y <= 0 ? 0 : maxHeight - height;
                }
                
                element.style.left = `${x}px`;
                element.style.top = `${y}px`;
                
                requestAnimationFrame(move);
            };
            
            move();
        }
        
        // 显示下一个单词意思
        function showNextMeaning() {
            if (usedMeanings.length >= wordsData.length) {
                // 所有单词已完成
                endGame(true);
                return;
            }
            
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * wordsData.length);
            } while (usedMeanings.includes(randomIndex));
            
            usedMeanings.push(randomIndex);
            currentMeaningIndex = randomIndex;
            currentMeaning = wordsData[randomIndex].meaning;
            meaningDisplay.textContent = currentMeaning;
            
            // 改变背景颜色增加视觉效果
            const colors = [
                'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)',
                'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
                'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
                'linear-gradient(135deg, #ffc3a0 0%, #ffafbd 100%)',
                'linear-gradient(135deg, #a6c1ee 0%, #fbc2eb 100%)'
            ];
            meaningDisplay.style.background = colors[Math.floor(Math.random() * colors.length)];
        }
        
        // 处理单词点击
        function handleWordClick(event) {
            if (!isGameRunning) return;
            
            const clickedWord = event.target;
            const word = clickedWord.dataset.word;
            const meaning = clickedWord.dataset.meaning;
            
            // 检查是否匹配当前显示的单词意思
            if (meaning === currentMeaning) {
                // 正确
                score++;
                updateScoreDisplay();
                
                // 播放发音
                speakWord(word);
                
                // 添加特效
                createConfetti(clickedWord);
                
                // 移除单词
                clickedWord.style.transform = 'scale(1.2)';
                clickedWord.style.opacity = '0';
                setTimeout(() => {
                    clickedWord.remove();
                }, 300);
                
                wordElements = wordElements.filter(el => el !== clickedWord);
                
                // 显示下一个单词意思
                setTimeout(() => {
                    showNextMeaning();
                }, 500);
            } else {
                // 错误
                clickedWord.classList.add('shake');
                setTimeout(() => {
                    clickedWord.classList.remove('shake');
                }, 500);
            }
        }
        
        // 创建彩色纸屑效果
        function createConfetti(element) {
            const rect = element.getBoundingClientRect();
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${rect.left + rect.width/2}px`;
                confetti.style.top = `${rect.top + rect.height/2}px`;
                
                document.body.appendChild(confetti);
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = 2 + Math.random() * 3;
                const xVel = Math.cos(angle) * velocity;
                const yVel = Math.sin(angle) * velocity;
                
                let x = rect.left + rect.width/2;
                let y = rect.top + rect.height/2;
                let opacity = 1;
                
                const animate = () => {
                    x += xVel;
                    y += yVel;
                    yVel += 0.1; // 重力
                    opacity -= 0.02;
                    
                    confetti.style.left = `${x}px`;
                    confetti.style.top = `${y}px`;
                    confetti.style.opacity = opacity;
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        confetti.remove();
                    }
                };
                
                requestAnimationFrame(animate);
            }
        }
        
        // 朗读单词 - 修改后的版本支持Windows 7
        function speakWord(word) {
            // 尝试使用Web Speech API
            if ('speechSynthesis' in window) {
                try {
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9; // 稍微减慢语速
                    
                    // 检查是否有可用的语音
                    const voices = window.speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        // 优先选择英语语音
                        const englishVoices = voices.filter(v => v.lang.startsWith('en-'));
                        if (englishVoices.length > 0) {
                            utterance.voice = englishVoices[0];
                        } else {
                            utterance.voice = voices[0]; // 使用默认语音
                        }
                        window.speechSynthesis.speak(utterance);
                        return;
                    }
                    
                    // 如果没有可用的语音，等待语音列表加载
                    window.speechSynthesis.onvoiceschanged = function() {
                        const voices = window.speechSynthesis.getVoices();
                        if (voices.length > 0) {
                            const englishVoices = voices.filter(v => v.lang.startsWith('en-'));
                            if (englishVoices.length > 0) {
                                utterance.voice = englishVoices[0];
                            } else {
                                utterance.voice = voices[0];
                            }
                            window.speechSynthesis.speak(utterance);
                        } else {
                            // 如果仍然没有语音，回退到Google TTS
                            useGoogleTTS(word);
                        }
                        window.speechSynthesis.onvoiceschanged = null;
                    };
                    
                    // 如果在一定时间内没有触发voiceschanged事件，也回退
                    setTimeout(() => {
                        if (window.speechSynthesis.onvoiceschanged) {
                            window.speechSynthesis.onvoiceschanged = null;
                            useGoogleTTS(word);
                        }
                    }, 1000);
                    
                    return;
                } catch (e) {
                    console.error("Web Speech API错误:", e);
                    // 如果出错，回退到Google TTS
                    useGoogleTTS(word);
                }
            } else {
                // 浏览器不支持Web Speech API，使用Google TTS
                useGoogleTTS(word);
            }
        }
        
        // 使用Google TTS作为回退方案
        function useGoogleTTS(word) {
            // 创建一个隐藏的音频元素
            let audioElement = document.getElementById('tts-audio');
            if (!audioElement) {
                audioElement = document.createElement('audio');
                audioElement.id = 'tts-audio';
                audioElement.style.display = 'none';
                document.body.appendChild(audioElement);
            }
            
            // 使用Google的TTS服务
            const ttsUrl = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=en&q=${encodeURIComponent(word)}`;
            
            // 设置音频源并播放
            audioElement.src = ttsUrl;
            audioElement.play().catch(e => {
                console.error("无法播放音频:", e);
                // 如果播放失败，显示提示
                showMessage("无法播放发音，请检查网络连接", '#f5576c');
            });
        }
        
        // 更新计时显示
        function updateTimerDisplay() {
            timerDisplay.textContent = `时间: ${timeLeft}秒`;
            
            // 时间少于10秒时改变颜色
            if (timeLeft <= 10) {
                timerDisplay.style.background = 'linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%)';
                timerDisplay.style.color = 'white';
            } else {
                timerDisplay.style.background = 'rgba(255,255,255,0.8)';
                timerDisplay.style.color = '#333';
            }
        }
        
        // 更新分数显示
        function updateScoreDisplay() {
            scoreDisplay.textContent = `得分: ${score}`;
            
            // 分数高时改变颜色
            if (score >= 10) {
                scoreDisplay.style.background = 'linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%)';
                scoreDisplay.style.color = 'white';
            }
        }
        
        // 结束游戏
        function endGame(allCompleted = false) {
            clearInterval(timer);
            isGameRunning = false;
            importBtn.disabled = false;
            gameTimeSelect.disabled = false;
            
            // 停止所有单词移动
            wordElements.forEach(el => {
                el.style.pointerEvents = 'none';
            });
            
            // 显示结束消息
            if (allCompleted) {
                showMessage(`🎉 恭喜完成！\n得分: ${score}`, '#38ef7d');
            } else {
                showMessage(`⏰ 时间到！\n得分: ${score}`, '#f5576c');
            }
            
            // 3秒后重置游戏
            setTimeout(() => {
                resetGame();
            }, 3000);
        }
        
        // 显示消息
        function showMessage(msg, color) {
            messageDisplay.textContent = msg;
            messageDisplay.style.display = 'block';
            messageDisplay.style.background = color || 'linear-gradient(135deg, rgba(106,17,203,0.9) 0%, rgba(37,117,252,0.9) 100%)';
            setTimeout(() => {
                messageDisplay.style.display = 'none';
            }, 3000);
        }
        
        // 重置游戏
        function resetGame() {
            clearInterval(timer);
            isGameRunning = false;
            wordDisplay.innerHTML = '';
            meaningDisplay.textContent = '等待开始...';
            meaningDisplay.style.background = 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)';
            startBtn.textContent = '开始游戏';
            importBtn.disabled = false;
            gameTimeSelect.disabled = false;
            
            // 重置计时和分数显示
            timerDisplay.style.background = 'rgba(255,255,255,0.8)';
            timerDisplay.style.color = '#333';
            scoreDisplay.style.background = 'rgba(255,255,255,0.8)';
            scoreDisplay.style.color = '#333';
        }
    </script>
</body>
</html>